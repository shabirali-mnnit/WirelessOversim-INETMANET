Better queue implementation
Better state machine implementation